#!/usr/bin/env ruby
# frozen_string_literal: true

APP_PATH = File.expand_path('../config/application', __dir__)
require_relative '../config/boot'
require 'rails/command'
require 'colorize'

aliases = {
  'g' => 'generate',
  'd' => 'destroy',
  'c' => 'console',
  's' => 'server',
  'db' => 'dbconsole',
  'r' => 'runner',
  'brakeman' => 'brakeman -q -w2',
  't' => 'rspec',
  'test' => 'rspec',
  'tf' => 'rspec --tag feature',
  'test:request' => 'rspec --tag feature',
  'annotate' => 'annotate',
  'erd' => 'erd',
  'lint' => 'rubocop',
  'lint:fix' => 'rubocop -A',
  'setup' => 'setup'
}

command = ARGV.shift
command = aliases[command] || command

case command
when 'rspec --tag feature', 'rspec'
  cmd = "#{command} #{ARGV.join(' ')}"
  puts "Running: #{cmd}".blue
  system(cmd)
  system("make -s features") if ENV['GEN_FEATURES'] == 'true'
when 'annotate', 'erd', 'rubocop', 'rubocop -A'
  cmd = "#{command} #{ARGV.join(' ')}"
  puts "Running: #{cmd}".blue
  system(cmd)
else
  Rails::Command.invoke command, ARGV
end
